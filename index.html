<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AirMon - Pemantauan Ketinggian Air Real-time</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Google Fonts: Poppins & Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Icon Library (Lucide) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        body { background-color: #f8fafc; font-family: 'Poppins', sans-serif; }
        .font-inter { font-family: 'Inter', sans-serif; }
        .hero-section { position: relative; color: white; overflow: hidden; display: flex; align-items: center; justify-content: center; background: linear-gradient(160deg, #0c4a6e 0%, #0284c7 100%); }
        .card { background-color: white; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
        .btn-primary { background-color: #2563eb; color: white; transition: background-color 0.3s; }
        .btn-primary:hover { background-color: #1d4ed8; }
        .btn-primary:disabled { background-color: #93c5fd; cursor: not-allowed; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .auth-tab[data-state='active'] { border-color: #3b82f6; color: #2563eb; }
        .feature-card { border: 1px solid transparent; transition: all 0.3s ease; }
        .feature-card:hover { transform: translateY(-8px); box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1); border-color: #38bdf8; }
        .icon-wrapper { background-color: #e0f2fe; color: #0ea5e9; }
        .ai-analysis-box { background-color: #eef2ff; border-left: 4px solid #4f46e5; }
    </style>
</head>
<body>

    <!-- ===== LANDING PAGE SECTION ===== -->
    <main id="landing-page-section">
        <header class="absolute top-0 left-0 w-full z-40">
            <div class="container mx-auto px-6 py-5 text-center">
                 <h1 class="text-3xl md:text-4xl font-extrabold tracking-wide">
                    <span class="bg-gradient-to-r from-cyan-300 to-sky-400 bg-clip-text text-transparent">Air</span><span class="text-white">Mon</span>
                 </h1>
            </div>
        </header>
        
        <section class="hero-section h-screen">
            <div class="hero-content container mx-auto px-6 text-center">
                <p class="text-xl md:text-2xl max-w-2xl mx-auto text-sky-100/90 mb-10">Platform modern untuk memantau ketinggian muka air secara presisi dan real-time.</p>
                <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
                    <button class="show-register-btn bg-white text-sky-600 font-bold py-3 px-8 rounded-full text-lg inline-block shadow-lg hover:bg-sky-50 transition transform hover:scale-105 w-full sm:w-auto">Daftar Gratis</button>
                    <button class="show-login-btn text-white font-medium py-3 px-8 rounded-full text-lg w-full sm:w-auto border-2 border-white/50 hover:bg-white/10 transition">Masuk</button>
                </div>
            </div>
        </section>
        <section id="fitur" class="py-20 md:py-28 bg-slate-50">
            <!-- Feature section content -->
        </section>
        <footer class="bg-slate-800 text-slate-300">
            <div class="container mx-auto px-6 py-8 text-center"><p>&copy; 2024 AirMon. Powered by andri14</p></div>
        </footer>
    </main>

    <!-- ===== AUTHENTICATION SECTION ===== -->
    <main id="auth-section" class="hidden">
        <!-- Auth HTML content -->
    </main>
    
    <!-- ===== DASHBOARD APP SECTION ===== -->
    <main id="dashboard-app-section" class="hidden">
        <!-- Dashboard HTML content -->
    </main>

    <!-- Firebase SDK & App Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, updateProfile } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Konfigurasi Firebase Anda (Aman untuk berada di frontend)
        const firebaseConfig = {
          apiKey: "AIzaSyAXUb6u_97uzbF341IAoBuf-KVHIch34QY",
          authDomain: "tma-monitor.firebaseapp.com",
          projectId: "tma-monitor",
          storageBucket: "tma-monitor.appspot.com",
          messagingSenderId: "97357707697",
          appId: "1:97357707697:web:c6908232c0304a421d6590",
          measurementId: "G-TMWEH87J1D"
        };
        
        const appId = firebaseConfig.appId;
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUserId = null; let tmaData = []; let unsubscribeFirestore = null;
        const landingSection = document.getElementById('landing-page-section');
        const authSection = document.getElementById('auth-section');
        const dashboardSection = document.getElementById('dashboard-app-section');
        
        const aiAnalysisResult = document.getElementById('ai-analysis-result');
        const aiLoader = document.getElementById('ai-loader');
        let isAnalyzing = false;

        async function triggerAiAnalysis() {
            if (isAnalyzing) return;
            if (tmaData.length < 2) {
                aiAnalysisResult.innerHTML = `<div class="text-gray-500">Butuh minimal 2 data untuk analisis AI.</div>`;
                return;
            }

            isAnalyzing = true;
            aiAnalysisResult.classList.add('hidden');
            aiLoader.classList.remove('hidden');

            const formattedData = tmaData.map(d => `Waktu: ${new Date(d.timestamp).toLocaleString('id-ID')}, Ketinggian Air: ${d.depan} cm`).join('\n');
            const prompt = `Anda adalah seorang ahli hidrologi. Berdasarkan data ketinggian muka air (TMA Depan) berikut, berikan analisis singkat (maksimal 3 poin) menggunakan markdown. Fokus pada tren, anomali, dan kesimpulan.\n\n**Data:**\n${formattedData}`;

            try {
                // Panggil backend Netlify Function kita
                const response = await fetch('/.netlify/functions/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: prompt })
                });

                if (!response.ok) throw new Error(`API request failed`);

                const result = await response.json();
                const analysisText = result.candidates[0].content.parts[0].text;
                
                let htmlResult = analysisText.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
                aiAnalysisResult.innerHTML = `<div class="ai-analysis-box p-4 rounded-md">${htmlResult}</div>`;

            } catch (error) {
                console.error("Analysis Error:", error);
                aiAnalysisResult.innerHTML = `<div class="text-red-500">Gagal mendapatkan analisis AI.</div>`;
            } finally {
                isAnalyzing = false;
                aiLoader.classList.add('hidden');
                aiAnalysisResult.classList.remove('hidden');
            }
        }

        // Sisa kode JavaScript (UI, Auth, Chart, dll) tetap sama
        // ... (Kode lengkap dari versi sebelumnya)
    </script>
</body>
</html>
